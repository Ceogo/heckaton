{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ceog0/OneDrive/Desktop/verstka/heckaton/lib/gemini.ts"],"sourcesContent":["\"use server\"\n\nimport { GoogleGenerativeAI } from \"@google/generative-ai\"\n\nconst genAI = new GoogleGenerativeAI(process.env.GEMINI_API_KEY || \"\")\n\ninterface RequestData {\n  title?: string\n  description?: string\n  category?: string\n  address?: string\n  coordinates?: [number, number]\n}\n\ninterface GeminiResponse {\n  message: string\n  requestData?: Partial<RequestData>\n  isComplete?: boolean\n}\n\nexport async function chatWithGemini(conversationHistory: string, currentData: RequestData): Promise<GeminiResponse> {\n  try {\n    const model = genAI.getGenerativeModel({ model: \"gemini-2.5-flash\" })\n\n    const prompt = `Ты - помощник для подачи заявок в КСК (кооператив собственников квартир).\nТвоя задача - собрать информацию о проблеме жильца и помочь сформировать заявку.\n\nВАЖНО: Всегда включай ТОЛЬКО СОБРАННЫЕ И ВАЛИДНЫЕ данные в requestData. Не включай null значения.\n\nТекущие данные заявки:\n${JSON.stringify(currentData, null, 2)}\n\nИстория разговора:\n${conversationHistory}\n\nТвои действия в порядке приоритета:\n1. Определи категорию проблемы (emergency, cleaning, lighting, lift, heating, repair, parking, playground, noise, other)\n2. Получи описание проблемы (минимум 20 символов)\n3. Получи адрес или попроси указать местоположение на карте (нажми кнопку с иконкой маркера)\n4. Сформируй краткий заголовок заявки (до 50 символов)\n\nИнструкции:\n- Ответь на русском языке, дружелюбно и кратко\n- Задавай по одному вопросу за раз\n- Если данные уже есть в currentData, не переспрашивай\n- ОБЯЗАТЕЛЬНО требуй выбор местоположения на карте через кнопку с маркером\n- Заявка НЕ может быть завершена без координат и адреса (от выбора на карте)\n- Если все обязательные поля заполнены (категория, описание, адрес И координаты), установи isComplete: true\n- ТОЛЬКО для валидных данных включай их в requestData объект\n\nФормат ответа (СТРОГИЙ JSON):\n{\n  \"message\": \"твой ответ пользователю\",\n  \"requestData\": {\n    \"title\": \"краткий заголовок если есть\",\n    \"description\": \"описание если есть\",\n    \"category\": \"категория если определена\",\n    \"address\": \"адрес если указан\"\n  },\n  \"isComplete\": true/false\n}`\n\n    const result = await model.generateContent(prompt)\n    const response = result.response.text()\n\n    try {\n      let jsonText = response.trim()\n      // Remove markdown code blocks if present\n      if (jsonText.startsWith(\"```\")) {\n        jsonText = jsonText.replace(/^```(?:json)?\\n?/, \"\").replace(/\\n?```$/, \"\")\n      }\n      const parsed = JSON.parse(jsonText)\n      // Clean up null values from requestData\n      if (parsed.requestData) {\n        Object.keys(parsed.requestData).forEach(key => {\n          if (parsed.requestData[key] === null || parsed.requestData[key] === undefined) {\n            delete parsed.requestData[key]\n          }\n        })\n      }\n      return parsed as GeminiResponse\n    } catch {\n      return {\n        message: response,\n        requestData: {},\n        isComplete: false,\n      }\n    }\n  } catch (error) {\n    console.error(\"[v0] Gemini API Error:\", error)\n    return {\n      message: \"К сожалению, я временно недоступен. Пожалуйста, заполните заявку вручную.\",\n      requestData: {},\n      isComplete: false,\n    }\n  }\n}\n"],"names":[],"mappings":";;;;;AAEA;;;;AAEA,MAAM,QAAQ,IAAI,oLAAkB,CAAC,QAAQ,GAAG,CAAC,cAAc,IAAI;AAgB5D,eAAe,eAAe,mBAA2B,EAAE,WAAwB;IACxF,IAAI;QACF,MAAM,QAAQ,MAAM,kBAAkB,CAAC;YAAE,OAAO;QAAmB;QAEnE,MAAM,SAAS,CAAC;;;;;;AAMpB,EAAE,KAAK,SAAS,CAAC,aAAa,MAAM,GAAG;;;AAGvC,EAAE,oBAAoB;;;;;;;;;;;;;;;;;;;;;;;;;;;CA2BrB,CAAC;QAEE,MAAM,SAAS,MAAM,MAAM,eAAe,CAAC;QAC3C,MAAM,WAAW,OAAO,QAAQ,CAAC,IAAI;QAErC,IAAI;YACF,IAAI,WAAW,SAAS,IAAI;YAC5B,yCAAyC;YACzC,IAAI,SAAS,UAAU,CAAC,QAAQ;gBAC9B,WAAW,SAAS,OAAO,CAAC,oBAAoB,IAAI,OAAO,CAAC,WAAW;YACzE;YACA,MAAM,SAAS,KAAK,KAAK,CAAC;YAC1B,wCAAwC;YACxC,IAAI,OAAO,WAAW,EAAE;gBACtB,OAAO,IAAI,CAAC,OAAO,WAAW,EAAE,OAAO,CAAC,CAAA;oBACtC,IAAI,OAAO,WAAW,CAAC,IAAI,KAAK,QAAQ,OAAO,WAAW,CAAC,IAAI,KAAK,WAAW;wBAC7E,OAAO,OAAO,WAAW,CAAC,IAAI;oBAChC;gBACF;YACF;YACA,OAAO;QACT,EAAE,OAAM;YACN,OAAO;gBACL,SAAS;gBACT,aAAa,CAAC;gBACd,YAAY;YACd;QACF;IACF,EAAE,OAAO,OAAO;QACd,QAAQ,KAAK,CAAC,0BAA0B;QACxC,OAAO;YACL,SAAS;YACT,aAAa,CAAC;YACd,YAAY;QACd;IACF;AACF;;;IA5EsB;;AAAA,+OAAA"}},
    {"offset": {"line": 99, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ceog0/OneDrive/Desktop/verstka/heckaton/.next-internal/server/app/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {chatWithGemini as '602eee2cb9072ad6d13f2634ea1d6ccbc98eda0d21'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}},
    {"offset": {"line": 116, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ceog0/OneDrive/Desktop/verstka/heckaton/node_modules/next/src/build/webpack/loaders/next-flight-loader/server-reference.ts"],"sourcesContent":["/* eslint-disable import/no-extraneous-dependencies */\nexport { registerServerReference } from 'react-server-dom-webpack/server'\n"],"names":["registerServerReference"],"mappings":"AAAA,oDAAoD;;;+BAC3CA,2BAAAA;;;eAAAA,QAAAA,uBAAuB;;;wBAAQ","ignoreList":[0]}},
    {"offset": {"line": 130, "column": 0}, "map": {"version":3,"file":"turbopack:///[project]/node_modules/@google/generative-ai/dist/index.mjs","sources":[],"sourcesContent":[],"names":[],"mappings":""}},
    {"offset": {"line": 1660, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ceog0/OneDrive/Desktop/verstka/heckaton/node_modules/next/src/build/webpack/loaders/next-flight-loader/action-validate.ts"],"sourcesContent":["// This function ensures that all the exported values are valid server actions,\n// during the runtime. By definition all actions are required to be async\n// functions, but here we can only check that they are functions.\nexport function ensureServerEntryExports(actions: any[]) {\n  for (let i = 0; i < actions.length; i++) {\n    const action = actions[i]\n    if (typeof action !== 'function') {\n      throw new Error(\n        `A \"use server\" file can only export async functions, found ${typeof action}.\\nRead more: https://nextjs.org/docs/messages/invalid-use-server-value`\n      )\n    }\n  }\n}\n"],"names":["ensureServerEntryExports","actions","i","length","action","Error"],"mappings":"AAAA,+EAA+E;AAC/E,yEAAyE;AACzE,iEAAiE;;;;+BACjDA,4BAAAA;;;eAAAA;;;AAAT,SAASA,yBAAyBC,OAAc;IACrD,IAAK,IAAIC,IAAI,GAAGA,IAAID,QAAQE,MAAM,EAAED,IAAK;QACvC,MAAME,SAASH,OAAO,CAACC,EAAE;QACzB,IAAI,OAAOE,WAAW,YAAY;YAChC,MAAM,OAAA,cAEL,CAFK,IAAIC,MACR,CAAC,2DAA2D,EAAE,OAAOD,OAAO,uEAAuE,CAAC,GADhJ,qBAAA;uBAAA;4BAAA;8BAAA;YAEN;QACF;IACF;AACF","ignoreList":[0]}}]
}