{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 4, "column": 0}, "map": {"version":3,"sources":["file:///C:/Users/ceog0/OneDrive/Desktop/verstka/heckaton/components/map.tsx"],"sourcesContent":["\"use client\"\n\nimport { MapContainer, TileLayer, Marker, Popup, useMap } from \"react-leaflet\"\nimport MarkerClusterGroup from \"react-leaflet-cluster\"\nimport { useRequests } from \"@/store/requests-provider\"\nimport { useUser } from \"@/store/user-provider\"\nimport { getCategoryInfo } from \"@/lib/categories\"\nimport { useTheme } from \"./providers/theme-provider\"\nimport L from \"leaflet\"\nimport \"leaflet/dist/leaflet.css\"\nimport { useEffect } from \"react\"\n\nfunction MapThemeController() {\n  const map = useMap()\n  const { theme } = useTheme()\n\n  useEffect(() => {\n    const layer = L.tileLayer(\n      theme === \"dark\"\n        ? \"https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png\"\n        : \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\",\n      {\n        attribution: '&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a>',\n      },\n    )\n    layer.addTo(map)\n    return () => {\n      map.removeLayer(layer)\n    }\n  }, [theme, map])\n\n  return null\n}\n\nfunction createCustomIcon(category: string, status: string) {\n  const categoryInfo = getCategoryInfo(category)\n  const statusColors = {\n    new: \"#3b82f6\",\n    in_progress: \"#eab308\",\n    done: \"#22c55e\",\n  }\n  const color = statusColors[status as keyof typeof statusColors] || statusColors.new\n\n  const svgIcon = `\n    <svg width=\"32\" height=\"32\" viewBox=\"0 0 32 32\" xmlns=\"http://www.w3.org/2000/svg\">\n      <circle cx=\"16\" cy=\"16\" r=\"14\" fill=\"${color}\" stroke=\"white\" strokeWidth=\"2\"/>\n      <text x=\"16\" y=\"20\" fontSize=\"14\" textAnchor=\"middle\" fill=\"white\">${categoryInfo.icon}</text>\n    </svg>\n  `\n\n  return L.divIcon({\n    html: svgIcon,\n    className: \"custom-marker-icon\",\n    iconSize: [32, 32],\n    iconAnchor: [16, 16],\n    popupAnchor: [0, -16],\n  })\n}\n\nfunction MapCenterUpdater() {\n  const map = useMap()\n  const { user } = useUser()\n\n  useEffect(() => {\n    if (user?.cityCoords) {\n      map.setView(user.cityCoords, 12)\n    }\n  }, [user?.cityCoords, map])\n\n  return null\n}\n\nexport default function Map() {\n  const { requests } = useRequests()\n  const { user } = useUser()\n  const center: [number, number] = user?.cityCoords || [43.238293, 76.889709]\n\n  return (\n    <MapContainer center={center} zoom={12} className=\"h-full w-full\" zoomControl={true}>\n      <MapThemeController />\n      <MapCenterUpdater />\n      <TileLayer url=\"\" attribution=\"\" />\n      <MarkerClusterGroup\n        chunkedLoading\n        maxClusterRadius={60}\n        iconCreateFunction={(cluster) => {\n          const count = cluster.getChildCount()\n          return L.divIcon({\n            html: `<div class=\"cluster-icon bg-primary border-2 border-white rounded-full w-10 h-10 flex items-center justify-center\">\n                <span class=\"text-sm font-bold text-white\">${count}</span>\n              </div>`,\n            className: \"custom-cluster-icon\",\n            iconSize: [40, 40],\n          })\n        }}\n      >\n        {requests.map((request) => (\n          <Marker\n            key={request.id}\n            position={request.coordinates}\n            icon={createCustomIcon(request.category, request.status)}\n          >\n            <Popup className=\"custom-popup\">\n              <div className=\"p-2 min-w-[200px]\">\n                <div className=\"flex items-start justify-between gap-2 mb-2\">\n                  <h3 className=\"font-semibold text-sm leading-tight\">{request.title}</h3>\n                  <span\n                    className={`shrink-0 px-2 py-1 rounded-full text-xs text-white ${\n                      request.status === \"new\"\n                        ? \"bg-blue-500\"\n                        : request.status === \"in_progress\"\n                          ? \"bg-yellow-500\"\n                          : \"bg-green-500\"\n                    }`}\n                  >\n                    {request.status === \"new\" ? \"Новая\" : request.status === \"in_progress\" ? \"В работе\" : \"Выполнена\"}\n                  </span>\n                </div>\n                <p className=\"text-xs text-muted-foreground mb-2 leading-relaxed\">{request.description}</p>\n                <div className=\"text-xs space-y-1\">\n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"text-muted-foreground\">Адрес:</span>\n                    <span className=\"font-medium\">{request.address}</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"text-muted-foreground\">Категория:</span>\n                    <span className=\"font-medium\">{getCategoryInfo(request.category).label}</span>\n                  </div>\n                  <div className=\"flex items-center gap-1\">\n                    <span className=\"text-muted-foreground\">Дата:</span>\n                    <span className=\"font-medium\">{new Date(request.createdAt).toLocaleDateString(\"ru-RU\")}</span>\n                  </div>\n                </div>\n              </div>\n            </Popup>\n          </Marker>\n        ))}\n      </MarkerClusterGroup>\n    </MapContainer>\n  )\n}\n"],"names":[],"mappings":"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"}}]
}